<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Organizer & Sticky Wall</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Roboto:wght@400;700&family=Permanent+Marker&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        
        <aside class="sidebar">
            <div class="menu-header">
                <h2>Task Hub</h2>
                <button class="menu-toggle"><i class="fas fa-bars"></i></button>
            </div>
            
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search">
            </div>

            <nav class="menu-sections">
                <p class="section-title">Views</p>
                <ul>
                    <li class="task-item active" id="matrix-menu-item" data-view="matrix">
                        <i class="fas fa-columns"></i> Eisenhower Matrix 
                    </li>
                    <li class="task-item" id="all-tasks-menu-item" data-view="all-tasks">
                        <i class="fas fa-tasks"></i> All Tasks
                    </li>
                    <li class="task-item" id="sticky-wall-menu-item" data-view="sticky-wall">
                        <i class="fas fa-sticky-note"></i> Sticky Wall
                    </li>
                </ul>
            </nav>
        </aside>

        <main class="relative">
            <div id="matrix-container" class="view-container active">
                <h1 class="matrix-title">Eisenhower Matrix</h1>
                <div class="matrix-grid relative">
                    <span class="matrix-axis-label absolute top-2/4 -left-10 transform -translate-y-1/2 rotate-270">IMPORTANT</span>
                    <span class="matrix-axis-label absolute bottom-2/4 -left-10 transform translate-y-1/2 rotate-270">NOT IMPORTANT</span>
                    <span class="matrix-axis-label absolute top-0 left-1/4 transform -translate-x-1/2 mt-2">URGENT</span>
                    <span class="matrix-axis-label absolute top-0 right-1/4 transform -translate-x-1/2 mt-2">NOT URGENT</span>
                    
                    <div class="quadrant quadrant-do" data-quadrant="do">
                        <h3><i class="fas fa-bolt"></i> Do Now</h3>
                        <ul class="task-list" id="do-list"></ul>
                        <button class="quadrant-add-btn" data-quadrant="do"><i class="fas fa-plus"></i> Add Task</button>
                    </div>
                    <div class="quadrant quadrant-schedule" data-quadrant="schedule">
                        <h3><i class="fas fa-calendar-alt"></i> Schedule</h3>
                        <ul class="task-list" id="schedule-list"></ul>
                        <button class="quadrant-add-btn" data-quadrant="schedule"><i class="fas fa-plus"></i> Add Task</button>
                    </div>
                    <div class="quadrant quadrant-delegate" data-quadrant="delegate">
                        <h3><i class="fas fa-user-plus"></i> Delegate</h3>
                        <ul class="task-list" id="delegate-list"></ul>
                        <button class="quadrant-add-btn" data-quadrant="delegate"><i class="fas fa-plus"></i> Add Task</button>
                    </div>
                    <div class="quadrant quadrant-eliminate" data-quadrant="eliminate">
                        <h3><i class="fas fa-trash-alt"></i> Eliminate</h3>
                        <ul class="task-list" id="eliminate-list"></ul>
                        <button class="quadrant-add-btn" data-quadrant="eliminate"><i class="fas fa-plus"></i> Add Task</button>
                    </div>
                </div>
            </div>

            <div id="all-tasks-container" class="view-container">
                <div class="all-tasks-header">
                    <h2>All Tasks List</h2>
                    <button class="btn save-btn" id="new-task-btn"><i class="fas fa-plus"></i> New Task</button>
                </div>
                <ul id="all-tasks-list">
                    </ul>
            </div>
            
            <div id="sticky-wall-container" class="view-container">
                <div id="corkboard" data-tool="select">
                    <canvas id="annotation-canvas"></canvas>
                </div>
                
                <div id="main-toolbar" class="hidden">
                    <div class="toolbar-segment tool-selection">
                        <button class="tool-btn active" data-tool="select" title="Select/Move">
                            <i class="ri-mouse-line"></i> Select
                        </button>
                        <button class="tool-btn" data-tool="marker" title="Marker">
                            <i class="ri-edit-line"></i> Marker
                        </button>
                        <button class="tool-btn" data-tool="highlight" title="Highlighter">
                            <i class="ri-mark-pen-line"></i> Highlight
                        </button>
                        <button class="tool-btn" data-tool="add-note" title="Add Sticky Note">
                            <i class="ri-sticky-note-line"></i> Note
                        </button>
                        <button class="tool-btn" data-tool="washi-tape" title="Washi Tape">
                            <i class="ri-coupon-4-line"></i> Tape
                        </button>
                    </div>
            
                    <div class="toolbar-segment draw-options">
                        <div id="current-color-indicator" style="background-color: black;" title="Current Color"></div>
                        <input type="range" id="stroke-width-slider" min="1" max="50" value="5" title="Stroke Width">
                        <input type="range" id="opacity-slider" min="0.1" max="1" step="0.05" value="1" title="Opacity (Highlighter Only)">
                    </div>

                    <div class="toolbar-segment">
                        <button class="tool-btn" id="undo-btn" title="Undo Last Stroke">
                            <i class="ri-arrow-go-back-line"></i>
                        </button>
                        <button class="tool-btn" id="clear-all-btn" title="Clear All Drawings">
                            <i class="ri-delete-bin-line"></i>
                        </button>
                    </div>
                </div>

                <div id="note-floating-toolbar" class="hidden">
                    <div class="note-toolbar-segment">
                        <button id="note-color-btn" class="note-tool-btn note-select-btn" title="Note Color" tabindex="-1">
                            <i class="ri-palette-line"></i>
                            <div id="current-note-color" class="w-4 h-4 rounded-full border border-gray-600">
                                <span class="note-color-indicator" style="background-color: white;"></span>
                            </div>
                        </button>
                        <div id="note-color-menu" class="note-dropdown-menu">
                            <div class="note-color-grid">
                                </div>
                        </div>
                    </div>

                    <div class="note-toolbar-segment">
                        <button id="note-font-btn" class="note-tool-btn note-select-btn" title="Font Style" tabindex="-1">
                            <i class="ri-font-family"></i>
                            <span id="current-font-display">Inter</span>
                        </button>
                        <div id="note-font-menu" class="note-dropdown-menu">
                            <div class="note-font-option" data-font="inter" style="font-family: 'Inter', sans-serif;">Inter (Default)</div>
                            <div class="note-font-option" data-font="roboto" style="font-family: 'Roboto', sans-serif;">Roboto</div>
                            <div class="note-font-option" data-font="marker" style="font-family: 'Permanent Marker', cursive;">Marker</div>
                        </div>
                    </div>
                    
                    <div class="note-toolbar-segment">
                        <button id="note-size-btn" class="note-tool-btn note-select-btn" title="Font Size" tabindex="-1">
                            <i class="ri-text"></i>
                            <span id="current-size-display">Medium</span>
                        </button>
                        <div id="note-size-menu" class="note-dropdown-menu">
                            <div class="note-size-option" data-size="small">Small (14px)</div>
                            <div class="note-size-option" data-size="medium">Medium (16px)</div>
                            <div class="note-size-option" data-size="large">Large (18px)</div>
                        </div>
                    </div>
                    
                    <div class="note-toolbar-segment">
                        <button class="note-tool-btn" data-text-style="bold" title="Bold" tabindex="-1">
                            <i class="ri-bold"></i>
                        </button>
                        <button class="note-tool-btn" data-text-style="strike" title="Strikethrough" tabindex="-1">
                            <i class="ri-strikethrough"></i>
                        </button>
                        <button class="note-tool-btn" data-text-style="unordered-list" title="Bullet List" tabindex="-1">
                            <i class="ri-list-unordered"></i>
                        </button>
                        <button class="note-tool-btn" data-text-style="ordered-list" title="Numbered List" tabindex="-1">
                            <i class="ri-list-ordered"></i>
                        </button>
                        <button class="note-tool-btn" id="note-author-btn" title="Insert Author/Username" tabindex="-1">
                            <i class="ri-at-line"></i>
                        </button>
                    </div>
                    
                    <div class="note-toolbar-segment note-right-edge">
                        <button class="note-tool-btn note-draw-toggle" title="Draw on Note" tabindex="-1">
                            <i class="ri-brush-line"></i>
                        </button>
                        <button class="note-tool-btn note-delete-btn" title="Delete Note" tabindex="-1">
                            <i class="ri-delete-bin-line"></i>
                        </button>
                    </div>
                </div>

            </div>

            <div id="task-details-modal" class="modal-overlay">
                <div class="modal-content">
                    <button class="close-button"><i class="fas fa-times"></i></button>
                    <h2>Task Details</h2>

                    <form id="task-form">
                        <div class="form-group">
                            <label for="task-title"><i class="fas fa-heading"></i> Title</label>
                            <input type="text" id="task-title" name="task-title" required>
                        </div>

                        <div class="form-group">
                            <label for="task-description"><i class="fas fa-info-circle"></i> Description</label>
                            <textarea id="task-description" name="task-description"></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group half-width">
                                <label for="task-due-date"><i class="fas fa-calendar-day"></i> Due Date</label>
                                <input type="date" id="task-due-date" name="task-due-date">
                            </div>
                            <div class="form-group half-width">
                                <label for="task-priority"><i class="fas fa-star"></i> Quadrant</label>
                                <select id="task-priority" name="task-priority">
                                    <option value="do">Do Now (Urgent & Important)</option>
                                    <option value="schedule">Schedule (Not Urgent & Important)</option>
                                    <option value="delegate">Delegate (Urgent & Not Important)</option>
                                    <option value="eliminate">Eliminate (Not Urgent & Not Important)</option>
                                </select>
                            </div>
                        </div>

                        <div id="sticky-note-settings" class="hidden">
                            <div class="form-group">
                                <label><i class="fas fa-paint-brush"></i> Note Color</label>
                                <div id="sticky-note-color-picker" class="flex flex-wrap gap-2">
                                    </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label><i class="fas fa-list-check"></i> Subtasks</label>
                            <ul id="subtask-list" class="subtask-list">
                                <li class="new-subtask">
                                    <input type="text" placeholder="Add a new subtask">
                                    <button type="button" class="add-subtask-btn"><i class="fas fa-plus"></i></button>
                                </li>
                            </ul>
                        </div>

                        <div class="modal-actions">
                            <button type="button" id="delete-task-btn" class="btn delete-btn"><i class="fas fa-trash"></i> Delete Task</button>
                            <button type="submit" class="btn save-btn"><i class="fas fa-save"></i> Save Changes</button>
                        </div>

                        <input type="hidden" id="current-task-id" name="current-task-id">
                    </form>
                </div>
            </div>
            
            <div id="custom-confirm-dialog" class="custom-confirm-overlay hidden">
                <div class="custom-confirm-box">
                    <p id="confirm-message">Are you sure you want to proceed?</p>
                    <div class="actions">
                        <button id="confirm-cancel-btn">Cancel</button>
                        <button id="confirm-delete-btn">Delete</button>
                    </div>
                </div>
            </div>
            
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, arrayUnion, arrayRemove, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db = null;
        let auth = null;
        let userId = null;
        let isAuthReady = false;

        if (firebaseConfig) {
            setLogLevel('Debug');
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            // Authentication setup
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                } else {
                    try {
                        if (initialAuthToken) {
                            await signInWithCustomToken(auth, initialAuthToken);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (error) {
                        console.error("Firebase auth error:", error);
                    }
                }
                // Mark authentication as ready
                isAuthReady = true;
                if (window.initializeAppLogic) {
                    // Call the main initialization function in script.js once Firebase is ready
                    window.initializeAppLogic(db, auth, userId, isAuthReady, appId);
                }
            });
        }
    </script>
    
    <script src="script.js"></script>
</body>
</html>